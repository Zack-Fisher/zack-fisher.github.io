(()=>{var e={627:e=>{e.exports=function(e,t,n){return t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,n){const o=e.length;if(t>=o||n<=0||t<0)return;const r=o-(n=t+n>o?o-t:n);for(let o=t;o<r;++o)e[o]=e[o+n];e.length=r}const t="undefined"==typeof performance?()=>Date.now():()=>performance.now();function o(e,t,n=[]){const o=e.split(",");for(const e of o){if(n.includes(e))return!1;if(e.startsWith("!")&&t[e.slice(1)])return!1;if(!e.startsWith("!")&&!t[e])return!1}return!0}function r(e){for(const t in e.stats.filterInvocationCount)e.stats.filterInvocationCount[t]=0;for(const t of e.stats.systems){t.timeElapsed=0;for(const e in t.filters)t.filters[e]=0}e.stats.currentSystem=0}function s(t,n,r){n[r]&&(t.stats.componentCount[r]-=1),delete n[r];for(const s in t.filters){const i=t.filters[s];if(o(s,n)&&!i.includes(n))i.push(n);else if(a(s,r)){const t=i.indexOf(n);t>=0&&e(i,t,1)}}}function i(t,n,o=!1){for(const e in n)n[e]&&(t.stats.componentCount[e]-=1);const r=t.entities.indexOf(n);if(e(t.entities,r,1),o)for(let e=0;e<t.deferredRemovals.entities.length;e++)t.deferredRemovals.entities[e]>=r&&(t.deferredRemovals.entities[e]-=1);for(const o in t.filters){const r=t.filters[o],s=r.indexOf(n);s>=0&&e(r,s,1)}}function a(e,t){return e===t||e.startsWith(`${t},`)||e.endsWith(`,${t}`)||e.includes(`,${t},`)}const c=function(e=Math.ceil(999999999*Math.random())){const t={entities:[],filters:{},systems:[],listeners:{added:new Set,removed:new Set,_added:new Set,_removed:new Set},deferredRemovals:{entities:[],components:[]},stats:{entityCount:0,componentCount:{},filterInvocationCount:{},systems:[],currentSystem:0,lastSendTime:0}};return"undefined"!=typeof window&&window.__MREINSTEIN_ECS_DEVTOOLS&&window.postMessage({id:"mreinstein/ecs-source",method:"worldCreated",data:t.stats},"*"),t},d=function(e){const t={};return e.entities.push(t),e.stats.entityCount++,e.listeners._added.add(t),t},f=function(t,n,r,s={}){if(!n[r]){Number.isInteger(t.stats.componentCount[r])||(t.stats.componentCount[r]=0),n[r]||(t.stats.componentCount[r]+=1),n[r]=s;for(const r in t.filters){const s=o(r,n),i=t.filters[r],a=i.indexOf(n);a>=0?s||e(i,a,1):s&&i.push(n)}}},l=function(e,t,n,r){const s=t.join(",");e.filters[s]||(e.filters[s]=e.entities.filter((e=>o(s,e)))),e.stats.filterInvocationCount[s]||(e.stats.filterInvocationCount[s]=0),e.stats.filterInvocationCount[s]+=1;const i=e.stats.currentSystem;if(e.stats.systems[i]&&(e.stats.systems[i].filters[s]||(e.stats.systems[i].filters[s]=0),e.stats.systems[i].filters[s]+=e.filters[s].length),"added"===n||"removed"===n){if(r){r.count=0;for(const t of e.listeners[n])o(s,t)&&(r.entries[r.count]=t,r.count++);return r}}else if(n)throw new Error(`Invalid listenerType '${n}'. Should be 'removed' or 'added'.`);return e.filters[s]},u=function(e,t){const n=t(e);e.stats.systems.push({name:t.name||"anonymousSystem",timeElapsed:0,filters:{}}),n.onPreFixedUpdate||(n.onPreFixedUpdate=function(){}),n.onFixedUpdate||(n.onFixedUpdate=function(){}),n.onPostFixedUpdate||(n.onPostFixedUpdate=function(){}),n.onPreUpdate||(n.onPreUpdate=function(){}),n.onUpdate||(n.onUpdate=function(){}),n.onPostUpdate||(n.onPostUpdate=function(){}),e.systems.push(n)},y=function(e,n){for(let o=0;o<e.systems.length;o++){e.stats.currentSystem=o;const r=e.systems[o],s=t();r.onUpdate(n),e.stats.systems[o].timeElapsed+=t()-s}},m=function(e){e.listeners.added.clear(),e.listeners.removed.clear();for(const t of e.listeners._added)e.listeners.added.add(t);for(const t of e.listeners._removed)e.listeners.removed.add(t);e.listeners._added.clear(),e.listeners._removed.clear();for(let t=0;t<e.deferredRemovals.components.length;t++){const[n,o]=e.deferredRemovals.components[t].split("__@@ECS@@__");s(e,e.entities[n],o)}e.deferredRemovals.components.length=0;for(const t of e.deferredRemovals.entities)i(e,e.entities[t]);e.deferredRemovals.entities.length=0,"undefined"!=typeof window&&window.__MREINSTEIN_ECS_DEVTOOLS&&performance.now()-e.stats.lastSendTime>250&&(e.stats.lastSendTime=performance.now(),window.postMessage({id:"mreinstein/ecs-source",method:"refreshData",data:e.stats},"*")),setTimeout(r,0,e)};var p=n(627),v=n.n(p);function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw s}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==b(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==b(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===b(r)?r:String(r)),o)}var r}function k(e,t,n){return t&&S(e.prototype,t),n&&S(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var x=new(function(){function e(){g(this,e),this.keys={},this.keyEvents={},window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this))}return k(e,[{key:"handleKeyDown",value:function(e){var t=e.key;this.keys[t]=!0,this.keyEvents[t]={down:!0,pressed:!0,released:!1}}},{key:"handleKeyUp",value:function(e){var t=e.key;this.keys[t]=!1,this.keyEvents[t]={down:!1,pressed:!1,released:!0}}},{key:"isKeyDown",value:function(e){return!!this.keys[e]}},{key:"isKeyPressed",value:function(e){return!!this.keyEvents[e]&&this.keyEvents[e].pressed}},{key:"isKeyReleased",value:function(e){return!!this.keyEvents[e]&&this.keyEvents[e].released}},{key:"update",value:function(){this.keyEvents={}}}]),e}()),E=c(),C=k((function e(t){g(this,e),this.path=t})),U=k((function e(t,n,o,r){g(this,e),this.x=t,this.y=n,this.w=o,this.h=r}));document.addEventListener("keydown",(function(e){var t;console.log("key pressed: "+e.key),"a"==e.key&&(t=d(E),f(E,t,"controller",{dx:0,dy:0,friction:.8}),f(E,t,"moveable",{dx:0,dy:0}),f(E,t,"sprite",new C("asset/player.png")),f(E,t,"rect",new U(50,80,32,32)))})),u(E,(function(e){return{onUpdate:function(t){var n,o=h(l(e,["controller","moveable"]));try{for(o.s();!(n=o.n()).done;){var r=n.value;r&&(x.isKeyDown("ArrowUp")&&(r.moveable.dy-=1),x.isKeyDown("ArrowDown")&&(r.moveable.dy+=1),x.isKeyDown("ArrowLeft")&&(r.moveable.dx-=1),x.isKeyDown("ArrowRight")&&(r.moveable.dx+=1),r.moveable.dx=v()(r.moveable.dx,-10,10),r.moveable.dy=v()(r.moveable.dy,-10,10),r.moveable.dx*=r.controller.friction,r.moveable.dy*=r.controller.friction)}}catch(e){o.e(e)}finally{o.f()}}}})),u(E,(function(e){return{onUpdate:function(t){var n,o=h(l(e,["rect","sprite"]));try{for(o.s();!(n=o.n()).done;){var r=n.value;if(r){var s=document.getElementById("entity-sprite-".concat(r.id));s&&(s.style.left="".concat(r.rect.x,"px"),s.style.top="".concat(r.rect.y,"px"),s.style.width="".concat(r.rect.w,"px"),s.style.height="".concat(r.rect.h,"px"))}}}catch(e){o.e(e)}finally{o.f()}}}})),u(E,(function(e){return{onUpdate:function(t){var n,o=h(l(e,["moveable","rect"]));try{for(o.s();!(n=o.n()).done;){var r=n.value;r&&(r.rect.x+=r.moveable.dx,r.rect.y+=r.moveable.dy)}}catch(e){o.e(e)}finally{o.f()}}}})),u(E,(function(e){var t=["sprite","rect"],n={count:0,entries:new Array(100)};return{onUpdate:function(o){if(l(e,t,"added",n)){var r,s=0,i=h(n.entries);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a){if(n.count<=s)break;console.log("making div of image path "+a.sprite.path);var c=document.createElement("div");c.style.position="absolute",c.style.backgroundImage="url(".concat(a.sprite.path,")"),c.style.backgroundSize="cover",c.id="entity-sprite-".concat(a.id),document.body.appendChild(c),s++}}}catch(e){i.e(e)}finally{i.f()}}if(l(e,t,"removed",n)){var d,f=0,u=h(n.entries);try{for(u.s();!(d=u.n()).done;){var y=d.value;if(y){if(n.count<=f)break;var m=document.querySelector("#entity-sprite-".concat(y.id));m&&m.remove(),f++}}}catch(e){u.e(e)}finally{u.f()}}}}}));var _=performance.now();!function e(){var t=performance.now(),n=t-_;_=t,x.update(),y(E,n),m(E),requestAnimationFrame(e)}()})()})();